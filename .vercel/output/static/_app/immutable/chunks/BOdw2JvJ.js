import{w as h}from"./DEG52fQV.js";const d="https://logiscorebe.onrender.com";class p{baseUrl;constructor(r=d){this.baseUrl=r}async request(r,s={}){const t=`${this.baseUrl}${r}`,e=await fetch(t,{headers:{"Content-Type":"application/json",...s.headers},...s});if(!e.ok)throw new Error(`API request failed: ${e.status} ${e.statusText}`);return e.json()}async healthCheck(){return this.request("/health")}async getFreightForwarders(){return this.request("/api/freight-forwarders/")}async getFreightForwarder(r){return this.request(`/api/freight-forwarders/${r}`)}async getReviews(r){return this.request(`/api/reviews/?freight_forwarder_id=${r}`)}async createReview(r){return this.request("/api/reviews/",{method:"POST",body:JSON.stringify(r)})}async searchFreightForwarders(r){return this.request(`/api/search/?q=${encodeURIComponent(r)}`)}async signup(r,s,t,e,o){return this.request("/api/users/signup",{method:"POST",body:JSON.stringify({email:r,password:s,name:t,company:e,user_type:o})})}async signin(r,s){return this.request("/api/users/signin",{method:"POST",body:JSON.stringify({email:r,password:s})})}async changePassword(r,s,t){return this.request("/api/users/change-password",{method:"POST",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify({current_password:r,new_password:s})})}async forgotPassword(r){return this.request("/api/users/forgot-password",{method:"POST",body:JSON.stringify({email:r})})}async resetPassword(r,s,t){return this.request("/api/users/reset-password",{method:"POST",body:JSON.stringify({email:r,reset_token:s,new_password:t})})}async getGitHubAuthUrl(){return this.request("/api/users/github/auth")}async handleGitHubCallback(r){return this.request("/api/users/github/callback",{method:"POST",body:JSON.stringify({code:r})})}async getCurrentUser(r){return this.request("/api/users/me",{headers:{Authorization:`Bearer ${r}`}})}async createSubscription(r,s,t,e){return this.request("/api/subscriptions/create",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:JSON.stringify({plan_id:r,plan_name:s,user_type:t})})}async getSubscriptionPlans(r){return this.request("/api/subscriptions/plans",{headers:{Authorization:`Bearer ${r}`}})}async getCurrentSubscription(r){return this.request("/api/subscriptions/current",{headers:{Authorization:`Bearer ${r}`}})}}const u=new p;function f(){const{subscribe:l,set:r,update:s}=h({user:null,token:null,isLoading:!1,error:null});if(typeof window<"u"){const t=localStorage.getItem("logiscore_token"),e=localStorage.getItem("logiscore_user");if(t&&e)try{const o=JSON.parse(e);r({user:o,token:t,isLoading:!1,error:null})}catch{localStorage.removeItem("logiscore_token"),localStorage.removeItem("logiscore_user")}}return{subscribe:l,setAuth:(t,e)=>{typeof window<"u"&&(localStorage.setItem("logiscore_token",e),localStorage.setItem("logiscore_user",JSON.stringify(t))),r({user:t,token:e,isLoading:!1,error:null})},logout:()=>{typeof window<"u"&&(localStorage.removeItem("logiscore_token"),localStorage.removeItem("logiscore_user")),r({user:null,token:null,isLoading:!1,error:null})},setLoading:t=>{s(e=>({...e,isLoading:t}))},setError:t=>{s(e=>({...e,error:t}))},async signup(t,e,o,n,c){s(a=>({...a,isLoading:!0,error:null}));try{const{user:a,access_token:i}=await u.signup(t,e,o,n,c);return this.setAuth(a,i),{user:a,token:i}}catch(a){const i=a instanceof Error?a.message:"Signup failed";throw s(g=>({...g,error:i,isLoading:!1})),a}},async signin(t,e){s(o=>({...o,isLoading:!0,error:null}));try{const{user:o,access_token:n}=await u.signin(t,e);return this.setAuth(o,n),{user:o,token:n}}catch(o){const n=o instanceof Error?o.message:"Sign in failed";throw s(c=>({...c,error:n,isLoading:!1})),o}},async getCurrentUser(){s(t=>({...t,isLoading:!0}));try{const t=localStorage.getItem("logiscore_token");if(!t)throw new Error("No token found");const e=await u.getCurrentUser(t);return s(o=>({...o,user:e,isLoading:!1})),e}catch(t){const e=t instanceof Error?t.message:"Failed to get current user";throw s(o=>({...o,error:e,isLoading:!1})),this.logout(),t}},async handleGitHubCallback(t){s(e=>({...e,isLoading:!0,error:null}));try{const{access_token:e,user:o}=await u.handleGitHubCallback(t);return this.setAuth(o,e),{user:o,access_token:e}}catch(e){const o=e instanceof Error?e.message:"GitHub authentication failed";throw s(n=>({...n,error:o,isLoading:!1})),e}}}}const w=f();export{w as a,u as b};
